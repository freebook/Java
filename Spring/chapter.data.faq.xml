<?xml version="1.0" encoding="UTF-8"?>
<chapter id="data.faq">
	<title>Spring Data FAQ</title>
	<section>
		<title>No identifier specified for entity</title>
		<para></para>
	</section>
	<section>
		<title>Oracle Date 类型显示日期和时间</title>
		<programlisting>
			<![CDATA[
package cn.netkiller.api.domain.oracle;

import java.util.Date;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.SequenceGenerator;
import javax.persistence.Table;
import javax.validation.constraints.NotNull;

import org.springframework.format.annotation.DateTimeFormat;
import org.springframework.format.annotation.DateTimeFormat.ISO;

import com.fasterxml.jackson.annotation.JsonFormat;

@Entity
@Table(name = "test")
public class Test {

	@Id
	@Column(name = "ID")
	@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "test_id_Sequence")
	@SequenceGenerator(name = "test_id_Sequence", sequenceName = "test")
	private Long id;

	@NotNull
	@DateTimeFormat(iso = ISO.DATE_TIME)
	@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
	public Date createdate;

	public Member() {

	}

	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public Date getCreatedate() {
		return createdate;
	}

	public void setCreatedate(Date createdate) {
		this.createdate = createdate;
	}

}
			]]>
		</programlisting>
	</section>
	<section>
		<title>java.lang.ClassCastException: java.lang.Long cannot be cast to java.lang.Integer</title>
		<para>问题描述，Restful 请求返回错误，检查数据库 BigInt 修改为 无符号整形，错误依旧存在</para>
		<screen>
			<![CDATA[
ALTER TABLE `cms`.`comment` 
CHANGE COLUMN `user_id` `user_id` INT(10) UNSIGNED NULL DEFAULT NULL ;
			]]>
		</screen>
		<para>去掉 UNSIGNED 后，错误消失</para>
		<screen>
			<![CDATA[
ALTER TABLE `cms`.`comment` 
CHANGE COLUMN `user_id` `user_id` INT NULL DEFAULT NULL ;
			]]>
		</screen>
		<para>Java 认为 INT(10) UNSIGNED 是 Long 型。</para>
	</section>
	<section>
		<title>Executing an update/delete query; nested exception is javax.persistence.TransactionRequiredException: Executing an update/delete query</title>
		<para>Internal Server Error","exception":"org.springframework.dao.InvalidDataAccessApiUsageException","message":"Executing an update/delete query; nested exception is javax.persistence.TransactionRequiredException: Executing an update/delete query"</para>
		<programlisting>
			<![CDATA[
			
			]]>
		</programlisting>
	</section>
</chapter>