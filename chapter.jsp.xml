<?xml version="1.0" encoding="UTF-8"?>
<chapter id="index"><?dbhtml dir="jsp" ?>
	<title>JSP</title>
	<section id="request">
		<title>request</title>
		<screen>
new URL(
	request.getScheme(), 
    request.getServerName(), 
    request.getServerPort(), 
    request.getContextPath()
    );		
		</screen>
		<para>获取主机名</para>
		<screen>
		<![CDATA[
<%=request.getServerName() %>
		]]>
		</screen>
		<section id="response.sendRedirect">
			<title>sendRedirect</title>
			<para>页面跳转</para>
			<screen>
response.sendRedirect("/content/test.jsp");			
			</screen>
		</section>
	</section>
	<section id="common">
		<title>注释</title>
		<para>JSP页面中的注释有以下几种样式的注释方法：</para>
		<programlisting>
		<![CDATA[
JSP页面中的HTML注释 
     <!-- 注释内容 -->  

JSP页面中的普通注释,不会再浏览器中输出
     
    <% // 注释内容 %>    
    <% /* 注释内容 */ %> 

JSP页面中的隐藏注释,不会再浏览器中输出 
<%-- 注释内容 --%>
		]]>
		</programlisting>
	</section>
	<section id="page">
		<title>page</title>
		<screen>
		<![CDATA[
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>		
		]]>
		</screen>
	</section>
	<section id="trimDirectiveWhitespaces">
		<title>trimDirectiveWhitespaces</title>
		<para>删除JSP编译产生的空行</para>
		<screen>
		<![CDATA[
<%@ page trimDirectiveWhitespaces="true" %> 
		]]>		
		</screen>
	</section>
	<section id="include">
		<title>include</title>
		<screen>
		<![CDATA[
<%@ include file="analytics.jsp" %>
		]]>
		</screen>
		
		<screen>
		<![CDATA[
<jsp:include page="telephone.jsp" />
<jsp:include page="address.jsp" flush="true"/> 
<jsp:include page="${request.getContentType()}/module/html.body.begin.html" flush="true" />

		]]>
		</screen>		
		<para>file 与 page 的区别是，file 将文件包含进当前文件，然后变成成servlet。 page 是运行的时候才会包含文件输出结果包含进当前文件。</para>
		<screen>
		<![CDATA[
<pre>

<%@include file="inc.html" %>
=============
<%@include file="/inc.html" %>
=============
<jsp:include page="inc.html" />
=============
<jsp:include page="inc.html" flush="true" />
==============
<jsp:include page="/inc.html" flush="true" />
==============
<jsp:include page="${request.getContentType()}/inc.html" flush="true" />

</pre>
		]]>
		</screen>
		<para>注意上面包含结果相同，使用上略有差异。</para>
	</section>
	<section id="jsp">
		<title>jsp</title>
		<section>
			<title>jsp:forward</title>
			<para>jsp:forward 只能跳转到存在的物理页面</para>
			<screen>
			<![CDATA[
<jsp:forward page="/test.jsp" />
			]]>
			</screen>
		</section>
	</section>
	
	<section id="jstl">
		<title>JSTL(JavaServer Pages Standard Tag Library)</title>
		<programlisting>
		<![CDATA[
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
		]]>
		</programlisting>
		<section id="out">
			<title>c:out</title>
			<programlisting>
			<![CDATA[
<c:out value="${variable}"/>
			]]>
			</programlisting>	
		</section>
		<section id="remove">
			<title>c:remove</title>
			<programlisting>
			<![CDATA[
<c:remove var="message" scope="session" />
			]]>
			</programlisting>	
		</section>
		<section id="import">
			<title>c:import</title>
			<programlisting>
			<![CDATA[
<c:import url="http://www.netkiller.cn" />		

<c:import var="html" url="http://www.netkiller.cn"/>
<c:out value="${html}"/>	
			]]>
			</programlisting>
			<para>传递GET参数</para>
			<programlisting>
			<![CDATA[
<c:import url="http://www.netkiller.cn" > 
	<c:param name="id" value="10" />
	<c:param name="name" value="neo" /> 
</c:import> 			
			]]>
			</programlisting>
			<para>异常处理</para>
			<programlisting>
			<![CDATA[
<c:catch var="exception">

  <c:import url="ftp://ftp.example.com/package/README"/>

</c:catch>

<c:if test="${not empty exception}">

  Sorry, the remote content is not currently available.

</c:if>			
			]]>
			</programlisting>
			<para>在Context间切换</para>
			<programlisting>
			<![CDATA[
server.conf: 
<Context  reloadable="true" crossContext="true" /> 

<c:import url="/path/to/file.jsp" context=/project1" /> 			
<c:import url="/path/to/file.jsp" context=/project2" />
			]]>
			</programlisting>
		</section>
		<section id="forEach">
			<title>c:forEach</title>
		
			<section>
				<title>List 处理</title>
				<programlisting>
				<![CDATA[
<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
	pageEncoding="ISO-8859-1"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Insert title here</title>
</head>
<body>
	${bookList}
	<br>

	<c:forEach items="${bookList}" var="node">
		<c:out value="${node}"></c:out><br>
	</c:forEach>

</body>
</html>
				]]>
				</programlisting>
			</section>
			<section>
				<title>Map 处理</title>
				<programlisting>
				<![CDATA[
<%@ page language="java" contentType="text/html; charset=utf-8"
    pageEncoding="utf-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Insert title here</title>
</head>
<body>
	<c:forEach items="${channel}" var="node">
		<a href="<c:out value="${node.value}"></c:out>"><c:out value="${node.key}"></c:out></a>
        <br/>
	</c:forEach>
</body>
</html>
				]]>
				</programlisting>
			</section>
		
		</section>
		<section id="fmt">
			<title>JSTL fmt Tag setBundle Example</title>
			<para>src/resources/config.properties</para>
			<programlisting>
			<![CDATA[
Name=Neo
Address=Shenzhen
Number=13322993040
			]]>
			</programlisting>
			<programlisting>
			<![CDATA[
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JSTL fmt:setBundle Tag</title>
</head>
<body>
	<fmt:setBundle basename="resources.config" var="config" />
	<fmt:message key="Name" bundle="${config}" />

	<fmt:message key="Address" bundle="${config}" />

	<fmt:message key="Number" bundle="${config}" />
</body>
</html>
			]]>
			</programlisting>
			<programlisting>
			<![CDATA[
	<fmt:bundle basename="lang">
		<fmt:message key="Name" />
		<fmt:message key="Address" />
	</fmt:bundle>			
			]]>
			</programlisting>
			<section>
				<title>Language Package</title>
				<programlisting>
				<![CDATA[
<fmt:setLocale value="en" />				
				]]>
				</programlisting>
			</section>
			<section>
				<title>fmt:message 变量</title>
				<programlisting>
				<![CDATA[
<fmt:message key="js" bundle="${config}" var="val" />
<c:out value="${val}"/>				
				]]>
				</programlisting>
			</section>
		</section>
		<section id="choose">
			<title>c:choose</title>
			<screen>
			<![CDATA[
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<c:choose>
	<c:when test="${session.auth eq 'true' }">
		
	</c:when>
	<c:otherwise>
		
	</c:otherwise>
</c:choose>			
			]]>
			</screen>
		</section>
	</section>	
	<section id="error-page">
		<title>error-page</title>
		<para>在 web.xml 中配置 error-page</para>
		<programlisting>
		<![CDATA[
<error-page>
	<error-code>400</error-code>
	<location>/error.jsp</location>
</error-page>

<error-page>
	<error-code>404</error-code>
	<location>/error.jsp</location>
</error-page>

<error-page>
	<error-code>500</error-code>
	<location>/error.jsp</location>
</error-page>
<!-- java.lang.Exception异常错误,依据这个标记可定义多个类似错误提示 -->
<error-page>
	<exception-type>java.lang.Exception</exception-type>
	<location>/error.jsp</location>
</error-page>
<!-- java.lang.NullPointerException异常错误,依据这个标记可定义多个类似错误提示 -->
<error-page>
	<exception-type>java.lang.NullPointerException </exception-type>
	<location>/error.jsp</location>
</error-page>

<error-page>
	<exception-type>javax.servlet.ServletException</exception-type>
	<location>/error.jsp</location>
</error-page>
		]]>
		</programlisting>
	</section>
</chapter>