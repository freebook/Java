<?xml version="1.0" encoding="UTF-8"?>
<chapter id="index"><?dbhtml dir="struts" ?>
	<title>Struts</title>
	<para><ulink url="http://struts.apache.org/" /></para>
	<para>You can checkout all the example applications from the Struts 2 GitHub repository at https://github.com/apache/struts-examples.</para>
	<section id="struts.xml">
		<title>struts.xml</title>
		<para>web.xml</para>
		<programlisting>
		<![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://java.sun.com/xml/ns/javaee"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
	id="WebApp_ID" version="3.0">
	<display-name>helloworld</display-name>
	<welcome-file-list>
		<welcome-file>index.html</welcome-file>
		<welcome-file>index.htm</welcome-file>
		<welcome-file>index.jsp</welcome-file>
		<welcome-file>default.html</welcome-file>
		<welcome-file>default.htm</welcome-file>
		<welcome-file>default.jsp</welcome-file>
	</welcome-file-list>

	<filter>
		<filter-name>struts2</filter-name>
		<filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>
	</filter>

	<filter-mapping>
		<filter-name>struts2</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>

</web-app>		
		]]>
		</programlisting>
		<section>
			<title>include</title>
			<programlisting>
			<![CDATA[
	<include file="/cn/netkiller/struts/ajax.xml" />
	<include file="/cn/netkiller/struts/admin.xml" />	
	<include file="/cn/netkiller/struts/logs.xml" />		
			]]>
			</programlisting>
		</section>
	</section>

	<section id="tags">
		<title>Struts Tags</title>
		<para>使用Struts Tags 需要在jsp页面中加入下面一行。</para>
		<programlisting>
		<![CDATA[
<%@ taglib prefix="s" uri="/struts-tags" %>
		]]>
		</programlisting>
		<section>
			<title>url</title>
			<programlisting>
			<![CDATA[
<p><a href="<s:url action='hello'/>">Hello World</a></p>

<s:url action="hello" var="helloLink">
  <s:param name="userName">Bruce Phillips</s:param>
</s:url>
 
<p><a href="${helloLink}">Hello Bruce Phillips</a></p>

			]]>
			</programlisting>						
		</section>
		<section id="include">
			<title>include</title>
			<programlisting>
			<![CDATA[
<s:include value="/pages/example.jsp"></s:include>			
			]]>
			</programlisting>
		</section>
		<section>
			<title>form</title>
			<programlisting>
			<![CDATA[
<p>Get your own personal hello by filling out and submitting this form.</p>
 
<s:form action="hello">
 
  <s:textfield name="userName" label="Your name" />
     
   <s:submit value="Submit" />
 
</s:form>
			]]>
			</programlisting>	
		</section>
		
		<section>
			<title>property tag</title>
			<programlisting>
			<![CDATA[
<s:property value="messageStore.message" />
			]]>
			</programlisting>	
		</section>
		<section id="select">
			<title>select</title>
			<programlisting>
			<![CDATA[
<s:select name="city" list="{'Beijing','Shanghai','Guangdong','Shenzhen'}" theme="simple" headerKey="Shenzhen" headerValue="Shenzhen"></s:select>
			
<select name="city" id="searchCriteriaForm_city">
    <option value="Shenzhen">Shenzhen</option>
    <option value="Beijing">Beijing</option>
    <option value="Shanghai">Shanghai</option>
    <option value="Guangdong">Guangdong</option>
    <option value="Shenzhen">Shenzhen</option>
</select>
			]]>
			</programlisting>	
			
			<programlisting>
			<![CDATA[
<s:select name="city" id="city" list="#{1:'Beijing',2:'Shanghai',3:'Guangdong',4:'Shenzhen'}"  label="city" listKey="key" listValue="value"  headerKey="4" headerValue="Shenzhen" />

<select name="city" id="city">
    <option value="4">Shenzhen</option>
    <option value="1">Beijing</option>
    <option value="2">Shanghai</option>
    <option value="3">Guangdong</option>
    <option value="4">Shenzhen</option>
</select>
			]]>
			</programlisting>
			
		</section>
		<section>
			<title></title>
			<programlisting>
			<![CDATA[

			]]>
			</programlisting>	
		</section>
		<section>
			<title></title>
			<programlisting>
			<![CDATA[

			]]>
			</programlisting>	
		</section>
	</section>
	
	<section id="action">
		<title>Action</title>
		<para>struts.xml</para>
		<programlisting>
		<![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">

<struts>

	<constant name="struts.devMode" value="true" />

	<package name="basicstruts2" extends="struts-default">
		<action name="index">
			<result>/index.jsp</result>
		</action>

		<action name="hello"
			class="org.apache.struts.helloworld.action.HelloWorldAction" method="execute">
			<result name="success">/HelloWorld.jsp</result>
		</action>

		<action name="register" class="org.apache.struts.register.action.Register"
			method="execute">
			<result name="success">/thankyou.jsp</result>
			<result name="input">/register.jsp</result>
		</action>

	</package>
</struts>
		]]>
		</programlisting>
	</section>
	<section id="ajax">
		<title>Ajax + JSON</title>
		<para>struts.xml 中加入</para>
		<programlisting>
		<![CDATA[
		<action name="Captcha" class="com.example.action.ajax.Captcha">
			<result name="success" type="json"></result>
		</action>
		]]>
		</programlisting>
		<para>Java 文件</para>
		<programlisting>
		<![CDATA[
package com.example.action.ajax;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.opensymphony.xwork2.Action;
import com.opensymphony.xwork2.ActionSupport;

public class Captcha extends ActionSupport {
	private static final long serialVersionUID = 7284583098398030297L;

	private String string1 = "A";
	private String[] stringarray1 = {"A1","B1"};
	private int number1 = 123456789;
	private int[] numberarray1 = {1,2,3,4,5,6,7,8,9};
	private List<String> lists = new ArrayList<String>();
	private Map<String, String> maps = new HashMap<String, String>();
	
	//no getter method, will not include in the JSON

	public Captcha(){
		lists.add("list1");
		lists.add("list2");
		lists.add("list3");
		lists.add("list4");
		lists.add("list5");
		
		maps.put("key1", "value1");
		maps.put("key2", "value2");
		maps.put("key3", "value3");
		maps.put("key4", "value4");
		maps.put("key5", "value5");
	}

	public String execute() {
               return Action.SUCCESS;
        }
	
	public String getString1() {
		return string1;
	}

	public void setString1(String string1) {
		this.string1 = string1;
	}

	public String[] getStringarray1() {
		return stringarray1;
	}

	public void setStringarray1(String[] stringarray1) {
		this.stringarray1 = stringarray1;
	}

	public int getNumber1() {
		return number1;
	}

	public void setNumber1(int number1) {
		this.number1 = number1;
	}

	public int[] getNumberarray1() {
		return numberarray1;
	}

	public void setNumberarray1(int[] numberarray1) {
		this.numberarray1 = numberarray1;
	}

	public List<String> getLists() {
		return lists;
	}

	public void setLists(List<String> lists) {
		this.lists = lists;
	}

	public Map<String, String> getMaps() {
		return maps;
	}

	public void setMaps(Map<String, String> maps) {
		this.maps = maps;
	}
	
}
		]]>
		</programlisting>
		<para>测试URL http://localhost:8080/ajax/Captcha.action</para>

		<section>
			<title>GET/POST JSON</title>
			<para>struts.xml 文件加入 enableSMD</para>
			<programlisting>
			<![CDATA[
		<action name="Captcha" class="com.example.action.ajax.Captcha">
			<interceptor-ref name="defaultStack" />
			<interceptor-ref name="json">
				<param name="enableSMD">true</param>
			</interceptor-ref>
			<result name="success" type="json"></result>
		</action>
			]]>
			</programlisting>
			<para>Java 代码</para>
			<programlisting>
			<![CDATA[
package com.example.action.ajax;

import com.opensymphony.xwork2.Action;
import com.opensymphony.xwork2.ActionSupport;

public class Captcha extends ActionSupport {
	private static final long serialVersionUID = 7284583098398030297L;

	private String phone = "13113668890";
	private String email = "netkiller@msn.com";
	private Boolean status = false;
	
	//no getter method, will not include in the JSON

	public Captcha() {

	}

	public String getEmail() {
		return email;
	}

	public void setEmail(String email) {
		this.email = email;
	}

	public String execute() {
		this.status = true;
		System.out.printf("%s, %s, %s, %b\n", this.getClass().getName(), this.getPhone(), this.getEmail(), this.getStatus());
		return Action.SUCCESS;
	}

	public String getPhone() {
		return this.phone;
	}

	public void setPhone(String phone) {
		this.phone = phone;
	}

	public void setStatus(Boolean status) {
		this.status = status;
	}
	public boolean getStatus() {
		return this.status;
	}
}
			]]>
			</programlisting>
			<para>使用 curl 模拟 post 测试</para>
			<programlisting>
			<![CDATA[
# curl http://192.168.4.34:8080/ajax/Captcha.do
{"email":"netkiller@msn.com","phone":"13113668890","status":true} 

# curl -X POST -H "Content-Type:application/json" -d '{"phone":"13066884444", "email":"neo.chan@live.com"}' http://192.168.4.34:8080/ajax/Captcha.do
{"email":"neo.chan@live.com","phone":"13066884444","status":true}
			]]>
			</programlisting>
			<para>GET 例子</para>
			<programlisting>
			<![CDATA[
# curl "http://192.168.4.34:8080/ajax/Captcha.do?phone=13322993040&email=netkiller@mac.com"
{"email":"netkiller@mac.com","phone":"13322993040","status":true}
			]]>
			</programlisting>		
		</section>
	</section>
</chapter>